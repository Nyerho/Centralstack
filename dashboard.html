<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - CentralTradeHub</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/dashboard.css">
    <link rel="stylesheet" href="css/responsive.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- Firebase Scripts -->
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-database-compat.js"></script>
</head>
<body class="dashboard-body">
    <!-- Authentication Protection -->
    <script>
        (function() {
            function checkAuth() {
                if (typeof firebase !== 'undefined') {
                    firebase.auth().onAuthStateChanged((user) => {
                        if (!user) {
                            alert('Please log in to access your dashboard.');
                            window.location.href = 'auth.html';
                        }
                    });
                } else {
                    setTimeout(checkAuth, 100);
                }
            }
            checkAuth();
        })();
    </script>

    <!-- Navigation Header -->
    <nav class="dashboard-navbar">
        <div class="nav-container">
            <div class="nav-logo">
                <img src="assets/images/logo.png" alt="CentralTradeHub">
                <span class="logo-text">CentralTradeHub</span>
            </div>
            
            <div class="nav-center">
                <div class="search-bar">
                    <i class="fas fa-search"></i>
                    <input type="text" placeholder="Search markets, instruments...">
                </div>
            </div>
            
            <div class="nav-right">
                <div class="nav-actions">
                    <button class="action-btn" title="Notifications">
                        <i class="fas fa-bell"></i>
                        <span class="notification-badge">3</span>
                    </button>
                    <button class="action-btn" title="Messages">
                        <i class="fas fa-envelope"></i>
                    </button>
                    <button class="action-btn" title="Settings">
                        <i class="fas fa-cog"></i>
                    </button>
                </div>
                
                <div class="user-menu">
                    <div class="user-info" onclick="toggleUserDropdown()">
                        <img src="assets/images/user-avatar.png" alt="User" class="user-avatar">
                        <div class="user-details">
                            <span class="user-name" id="dashboard-user-name">Loading...</span>
                            <span class="user-email" id="dashboard-user-email">Loading...</span>
                        </div>
                        <i class="fas fa-chevron-down"></i>
                    </div>
                    
                    <div class="user-dropdown" id="userDropdown">
                        <a href="profile.html" class="dropdown-item">
                            <i class="fas fa-user"></i> My Profile
                        </a>
                        <a href="profile.html#account-settings" class="dropdown-item">
                            <i class="fas fa-cog"></i> Account Settings
                        </a>
                        <a href="profile.html#security" class="dropdown-item">
                            <i class="fas fa-shield-alt"></i> Security
                        </a>
                        <div class="dropdown-divider"></div>
                        <a href="#" class="dropdown-item logout-item" onclick="handleLogout()">
                            <i class="fas fa-sign-out-alt"></i> Logout
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- Sidebar Navigation -->
    <aside class="dashboard-sidebar">
        <div class="sidebar-menu">
            <a href="#" class="menu-item active" data-section="overview">
                <i class="fas fa-tachometer-alt"></i>
                <span>Overview</span>
            </a>
            <a href="platform.html" class="menu-item" data-section="trading">
                <i class="fas fa-chart-line"></i>
                <span>Trading</span>
            </a>
            <a href="#" class="menu-item" data-section="portfolio">
                <i class="fas fa-briefcase"></i>
                <span>Portfolio</span>
            </a>
            <a href="#" class="menu-item" data-section="markets">
                <i class="fas fa-globe"></i>
                <span>Markets</span>
            </a>
            <a href="#" class="menu-item" data-section="history">
                <i class="fas fa-history"></i>
                <span>History</span>
            </a>
            <a href="funding.html" class="menu-item">
                <i class="fas fa-credit-card"></i>
                <span>Funding</span>
            </a>
            <a href="#" class="menu-item" data-section="analytics">
                <i class="fas fa-chart-bar"></i>
                <span>Analytics</span>
            </a>
            <a href="#" class="menu-item" data-section="education">
                <i class="fas fa-graduation-cap"></i>
                <span>Education</span>
            </a>
        </div>
        
        <div class="sidebar-footer">
            <div class="market-status">
                <span class="status-indicator active"></span>
                <span class="status-text">Markets Open</span>
            </div>
        </div>
    </aside>

    <!-- Main Dashboard Content -->
    <main class="dashboard-main">
        <!-- Overview Section -->
        <section id="overview-section" class="dashboard-section active">
            <!-- Account Summary Cards -->
            <div class="summary-cards">
                <div class="summary-card balance-card">
                    <div class="card-header">
                        <h3>Account Balance</h3>
                        <i class="fas fa-wallet"></i>
                    </div>
                    <div class="card-content">
                        <div class="balance-amount">$10,000.00</div>
                        <div class="balance-change positive">+$250.00 (2.5%)</div>
                    </div>
                </div>
                
                <div class="summary-card equity-card">
                    <div class="card-header">
                        <h3>Equity</h3>
                        <i class="fas fa-chart-pie"></i>
                    </div>
                    <div class="card-content">
                        <div class="equity-amount">$10,250.00</div>
                        <div class="equity-change positive">+$125.00 (1.2%)</div>
                    </div>
                </div>
                
                <div class="summary-card margin-card">
                    <div class="card-header">
                        <h3>Free Margin</h3>
                        <i class="fas fa-shield-alt"></i>
                    </div>
                    <div class="card-content">
                        <div class="margin-amount">$9,750.00</div>
                        <div class="margin-level">Margin Level: 2050%</div>
                    </div>
                </div>
                
                <div class="summary-card pnl-card">
                    <div class="card-header">
                        <h3>Today's P&L</h3>
                        <i class="fas fa-trending-up"></i>
                    </div>
                    <div class="card-content">
                        <div class="pnl-amount positive">+$125.00</div>
                        <div class="pnl-percentage">+1.25%</div>
                    </div>
                </div>
            </div>

            <!-- Quick Actions -->
            <div class="quick-actions">
                <h3>Quick Actions</h3>
                <div class="action-buttons">
                    <button class="action-button primary" onclick="openTradingModal()">
                        <i class="fas fa-plus"></i>
                        <span>New Trade</span>
                    </button>
                    <button class="action-button secondary" onclick="showDeposit()">
                        <i class="fas fa-arrow-down"></i>
                        <span>Deposit</span>
                    </button>
                    <button class="action-button secondary" onclick="showWithdraw()">
                        <i class="fas fa-arrow-up"></i>
                        <span>Withdraw</span>
                    </button>
                    <button class="action-button secondary" onclick="goToAnalytics()">
                        <i class="fas fa-chart-line"></i>
                        <span>Analytics</span>
                    </button>
                </div>
            </div>

            <!-- Portfolio Overview -->
            <div class="portfolio-overview">
                <div class="portfolio-header">
                    <h3>Portfolio Performance</h3>
                    <div class="time-filters">
                        <button class="time-btn active" data-period="1D">1D</button>
                        <button class="time-btn" data-period="1W">1W</button>
                        <button class="time-btn" data-period="1M">1M</button>
                        <button class="time-btn" data-period="3M">3M</button>
                        <button class="time-btn" data-period="1Y">1Y</button>
                    </div>
                </div>
                <div class="portfolio-chart">
                    <canvas id="portfolioChart"></canvas>
                </div>
            </div>

            <!-- Open Positions -->
            <div class="open-positions">
                <div class="section-header">
                    <h3>Open Positions</h3>
                    <a href="#" class="view-all">View All</a>
                </div>
                <div class="positions-table">
                    <table>
                        <thead>
                            <tr>
                                <th>Symbol</th>
                                <th>Type</th>
                                <th>Volume</th>
                                <th>Open Price</th>
                                <th>Current Price</th>
                                <th>P&L</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="positionsTableBody">
                            <tr>
                                <td>
                                    <div class="symbol-info">
                                        <span class="symbol">EUR/USD</span>
                                        <span class="symbol-name">Euro vs US Dollar</span>
                                    </div>
                                </td>
                                <td><span class="trade-type buy">BUY</span></td>
                                <td>0.10</td>
                                <td>1.0850</td>
                                <td class="current-price">1.0875</td>
                                <td class="pnl positive">+$25.00</td>
                                <td>
                                    <button class="btn-close" onclick="closePosition('EUR/USD')">
                                        <i class="fas fa-times"></i>
                                    </button>
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    <div class="symbol-info">
                                        <span class="symbol">GBP/USD</span>
                                        <span class="symbol-name">British Pound vs US Dollar</span>
                                    </div>
                                </td>
                                <td><span class="trade-type sell">SELL</span></td>
                                <td>0.05</td>
                                <td>1.2650</td>
                                <td class="current-price">1.2635</td>
                                <td class="pnl positive">+$7.50</td>
                                <td>
                                    <button class="btn-close" onclick="closePosition('GBP/USD')">
                                        <i class="fas fa-times"></i>
                                    </button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Market Overview -->
            <div class="market-overview-dashboard">
                <h3>Market Overview</h3>
                <div class="market-grid">
                    <div class="market-item">
                        <div class="market-symbol">EUR/USD</div>
                        <div class="market-price">1.0875</div>
                        <div class="market-change positive">+0.0025 (+0.23%)</div>
                    </div>
                    <div class="market-item">
                        <div class="market-symbol">GBP/USD</div>
                        <div class="market-price">1.2635</div>
                        <div class="market-change negative">-0.0015 (-0.12%)</div>
                    </div>
                    <div class="market-item">
                        <div class="market-symbol">USD/JPY</div>
                        <div class="market-price">149.85</div>
                        <div class="market-change positive">+0.45 (+0.30%)</div>
                    </div>
                    <div class="market-item">
                        <div class="market-symbol">AUD/USD</div>
                        <div class="market-price">0.6785</div>
                        <div class="market-change positive">+0.0012 (+0.18%)</div>
                    </div>
                </div>
            </div>

            <!-- Recent Activity -->
            <div class="recent-activity">
                <h3>Recent Activity</h3>
                <div class="activity-list">
                    <div class="activity-item">
                        <div class="activity-icon">
                            <i class="fas fa-arrow-up text-success"></i>
                        </div>
                        <div class="activity-content">
                            <div class="activity-title">Deposit Completed</div>
                            <div class="activity-description">$1,000.00 deposited via Bank Transfer</div>
                            <div class="activity-time">2 hours ago</div>
                        </div>
                    </div>
                    <div class="activity-item">
                        <div class="activity-icon">
                            <i class="fas fa-chart-line text-primary"></i>
                        </div>
                        <div class="activity-content">
                            <div class="activity-title">Trade Opened</div>
                            <div class="activity-description">BUY 0.10 EUR/USD at 1.0850</div>
                            <div class="activity-time">4 hours ago</div>
                        </div>
                    </div>
                    <div class="activity-item">
                        <div class="activity-icon">
                            <i class="fas fa-times-circle text-danger"></i>
                        </div>
                        <div class="activity-content">
                            <div class="activity-title">Trade Closed</div>
                            <div class="activity-description">SELL 0.05 USD/CAD - Profit: +$15.50</div>
                            <div class="activity-time">6 hours ago</div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Portfolio Section -->
        <section id="portfolio-section" class="dashboard-section">
            <div class="section-header">
                <h2>Portfolio Management</h2>
                <p>Manage your investment portfolio and track performance</p>
            </div>
            <div class="portfolio-content">
                <div class="portfolio-summary">
                    <div class="summary-card">
                        <h3>Total Portfolio Value</h3>
                        <div class="portfolio-value">$12,500.00</div>
                        <div class="portfolio-change positive">+$350.00 (2.88%)</div>
                    </div>
                </div>
                <div class="portfolio-holdings">
                    <h3>Current Holdings</h3>
                    <div class="holdings-table">
                        <div class="table-header">
                            <span>Asset</span>
                            <span>Quantity</span>
                            <span>Current Price</span>
                            <span>Total Value</span>
                            <span>P&L</span>
                        </div>
                        <div class="holding-row">
                            <span>EUR/USD</span>
                            <span>0.50 lots</span>
                            <span>1.0875</span>
                            <span>$5,437.50</span>
                            <span class="positive">+$125.00</span>
                        </div>
                        <div class="holding-row">
                            <span>GBP/USD</span>
                            <span>0.30 lots</span>
                            <span>1.2635</span>
                            <span>$3,790.50</span>
                            <span class="negative">-$45.00</span>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Markets Section -->
        <section id="markets-section" class="dashboard-section">
            <div class="section-header">
                <h2>Market Overview</h2>
                <p>Real-time market data and analysis</p>
            </div>
            <div class="markets-content">
                <div class="market-categories">
                    <div class="category-tabs">
                        <button class="tab-btn active" data-market="forex">Forex</button>
                        <button class="tab-btn" data-market="stocks">Stocks</button>
                        <button class="tab-btn" data-market="crypto">Crypto</button>
                        <button class="tab-btn" data-market="commodities">Commodities</button>
                    </div>
                </div>
                <div class="market-data">
                    <div class="market-grid">
                        <div class="market-card">
                            <div class="market-symbol">EUR/USD</div>
                            <div class="market-price">1.0875</div>
                            <div class="market-change positive">+0.0025 (+0.23%)</div>
                            <button class="trade-btn" onclick="window.open('platform.html', '_blank')">Trade</button>
                        </div>
                        <div class="market-card">
                            <div class="market-symbol">GBP/USD</div>
                            <div class="market-price">1.2635</div>
                            <div class="market-change negative">-0.0015 (-0.12%)</div>
                            <button class="trade-btn" onclick="window.open('platform.html', '_blank')">Trade</button>
                        </div>
                        <div class="market-card">
                            <div class="market-symbol">USD/JPY</div>
                            <div class="market-price">149.85</div>
                            <div class="market-change positive">+0.45 (+0.30%)</div>
                            <button class="trade-btn" onclick="window.open('platform.html', '_blank')">Trade</button>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- History Section -->
        <section id="history-section" class="dashboard-section">
            <div class="section-header">
                <h2>Trading History</h2>
                <p>View your complete trading history and performance</p>
            </div>
            <div class="history-content">
                <div class="history-filters">
                    <select class="filter-select">
                        <option value="all">All Trades</option>
                        <option value="profitable">Profitable Only</option>
                        <option value="losses">Losses Only</option>
                    </select>
                    <input type="date" class="date-filter" placeholder="From Date">
                    <input type="date" class="date-filter" placeholder="To Date">
                </div>
                <div class="history-table">
                    <div class="table-header">
                        <span>Date</span>
                        <span>Symbol</span>
                        <span>Type</span>
                        <span>Volume</span>
                        <span>Open Price</span>
                        <span>Close Price</span>
                        <span>P&L</span>
                    </div>
                    <div class="history-row">
                        <span>2024-01-15</span>
                        <span>EUR/USD</span>
                        <span>BUY</span>
                        <span>0.10</span>
                        <span>1.0850</span>
                        <span>1.0875</span>
                        <span class="positive">+$25.00</span>
                    </div>
                    <div class="history-row">
                        <span>2024-01-14</span>
                        <span>GBP/USD</span>
                        <span>SELL</span>
                        <span>0.05</span>
                        <span>1.2650</span>
                        <span>1.2635</span>
                        <span class="positive">+$7.50</span>
                    </div>
                </div>
            </div>
        </section>

        <!-- Analytics Section -->
        <section id="analytics-section" class="dashboard-section">
            <div class="section-header">
                <h2>Performance Analytics</h2>
                <p>Detailed analysis of your trading performance</p>
            </div>
            <div class="analytics-content">
                <div class="analytics-cards">
                    <div class="analytics-card">
                        <h3>Win Rate</h3>
                        <div class="metric-value">68.5%</div>
                        <div class="metric-change positive">+2.3%</div>
                    </div>
                    <div class="analytics-card">
                        <h3>Average Profit</h3>
                        <div class="metric-value">$45.20</div>
                        <div class="metric-change positive">+$5.10</div>
                    </div>
                    <div class="analytics-card">
                        <h3>Risk/Reward Ratio</h3>
                        <div class="metric-value">1:2.4</div>
                        <div class="metric-change positive">Improved</div>
                    </div>
                </div>
                <div class="analytics-charts">
                    <div class="chart-container">
                        <h3>Monthly Performance</h3>
                        <div class="chart-placeholder">
                            <p>Performance chart will be displayed here</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Education Section -->
        <section id="education-section" class="dashboard-section">
            <div class="section-header">
                <h2>Trading Education</h2>
                <p>Enhance your trading skills with our educational resources</p>
            </div>
            <div class="education-content">
                <div class="education-categories">
                    <div class="category-card">
                        <h3>Beginner Courses</h3>
                        <p>Start your trading journey with fundamental concepts</p>
                        <ul>
                            <li>Introduction to Forex Trading</li>
                            <li>Understanding Market Analysis</li>
                            <li>Risk Management Basics</li>
                        </ul>
                        <button class="course-btn">Start Learning</button>
                    </div>
                    <div class="category-card">
                        <h3>Advanced Strategies</h3>
                        <p>Master advanced trading techniques and strategies</p>
                        <ul>
                            <li>Technical Analysis Mastery</li>
                            <li>Algorithmic Trading</li>
                            <li>Portfolio Optimization</li>
                        </ul>
                        <button class="course-btn">Explore Advanced</button>
                    </div>
                    <div class="category-card">
                        <h3>Market Insights</h3>
                        <p>Stay updated with market trends and analysis</p>
                        <ul>
                            <li>Daily Market Reports</li>
                            <li>Economic Calendar</li>
                            <li>Expert Analysis</li>
                        </ul>
                        <button class="course-btn">View Insights</button>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- Scripts -->
    <script type="module" src="js/firebase-config.js"></script>
    <script type="module" src="js/firebase-auth.js"></script>
    <script type="module" src="js/firebase-database.js"></script>
    <script type="module" src="js/auth-integration.js"></script>
    <script type="module" src="js/user-profile-service.js"></script>
    <script src="js/dashboard.js"></script>
</body>
</html>