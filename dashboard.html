<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Dashboard - CentralTradeHub</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/dashboard.css">
    <link rel="stylesheet" href="css/responsive.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- Firebase Scripts -->
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-database-compat.js"></script>
</head>
<body class="dashboard-body">
    <!-- Authentication Protection -->
    <script>
        (function() {
            function checkAuth() {
                if (typeof firebase !== 'undefined') {
                    firebase.auth().onAuthStateChanged((user) => {
                        if (!user) {
                            alert('Please log in to access your dashboard.');
                            window.location.href = 'auth.html';
                        }
                    });
                } else {
                    setTimeout(checkAuth, 100);
                }
            }
            checkAuth();
        })();
    </script>

    <!-- Navigation Header -->
    <nav class="dashboard-navbar">
        <div class="nav-container">
            <div class="nav-left">
                <button class="mobile-menu-toggle" id="mobile-menu-toggle">
                    <i class="fas fa-bars"></i>
                </button>
                <div class="nav-logo">
                    <a href="index.html">
                        <img src="assets/images/logo-white.png" alt="CentralTradeHub" class="logo-img">
                    </a>
                </div>
            </div>
            <div class="nav-center">
                <div class="search-bar">
                    <i class="fas fa-search"></i>
                    <input type="text" placeholder="Search markets, instruments...">
                </div>
            </div>
            
            <div class="nav-right">
                <div class="nav-actions">
                    <button class="action-btn" title="Notifications" id="notifications-btn">
                        <i class="fas fa-bell"></i>
                        <span class="notification-badge">0</span>
                    </button>
                    <button class="action-btn" title="Messages" id="messages-btn">
                        <i class="fas fa-envelope"></i>
                    </button>
                    <button class="action-btn" title="Settings" id="settings-btn">
                        <i class="fas fa-cog"></i>
                    </button>
                </div>
                
                <div class="user-menu">
                    <div class="user-info" onclick="toggleUserDropdown()">
                        <img src="assets/images/user-avatar.png" alt="User" class="user-avatar">
                        <div class="user-details">
                            <span class="user-name" id="dashboard-user-name">User</span>
                            <span class="user-status">Online</span>
                        </div>
                        <i class="fas fa-chevron-down"></i>
                    </div>
                    
                    <div class="user-dropdown" id="userDropdown">
                        <a href="profile.html" class="dropdown-item">
                            <i class="fas fa-user"></i> My Profile
                        </a>
                        <a href="profile.html#account-settings" class="dropdown-item">
                            <i class="fas fa-cog"></i> Account Settings
                        </a>
                        <a href="profile.html#security" class="dropdown-item">
                            <i class="fas fa-shield-alt"></i> Security
                        </a>
                        <div class="dropdown-divider"></div>
                        <a href="#" class="dropdown-item logout-item" onclick="handleLogout()">
                            <i class="fas fa-sign-out-alt"></i> Logout
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- Sidebar Navigation -->
    <aside class="dashboard-sidebar">
        <div class="sidebar-menu">
            <a href="dashboard.html" class="menu-item active" data-section="overview">
                <i class="fas fa-chart-line"></i>
                <span>Overview</span>
            </a>
            <a href="#portfolio" class="menu-item" data-section="portfolio">
                <i class="fas fa-briefcase"></i>
                <span>Portfolio</span>
            </a>
            <a href="#markets" class="menu-item" data-section="markets">
                <i class="fas fa-chart-bar"></i>
                <span>Markets</span>
            </a>
            <a href="#history" class="menu-item" data-section="history">
                <i class="fas fa-history"></i>
                <span>History</span>
            </a>
            <a href="#analytics" class="menu-item" data-section="analytics">
                <i class="fas fa-analytics"></i>
                <span>Analytics</span>
            </a>
            <a href="#education" class="menu-item" data-section="education">
                <i class="fas fa-graduation-cap"></i>
                <span>Education</span>
            </a>
        </div>
        
        <div class="sidebar-footer">
            <div class="market-status">
                <span class="status-indicator active"></span>
                <span class="status-text">Markets Open</span>
            </div>
        </div>
    </aside>

    <!-- Main Dashboard Content -->
    <main class="dashboard-main">
        <!-- Overview Section -->
        <section id="overview-section" class="dashboard-section active">
            <!-- Account Summary Cards -->
            <div class="summary-cards">
                <div class="summary-card balance-card">
                    <div class="card-header">
                        <h3>Account Balance</h3>
                        <i class="fas fa-wallet"></i>
                    </div>
                    <div class="card-content">
                        <div class="balance-amount" id="account-balance">Loading...</div>
                        <div class="balance-change positive" id="balance-change">+$0.00 (0.0%)</div>
                    </div>
                </div>
                
                <div class="summary-card equity-card">
                    <div class="card-header">
                        <h3>Equity</h3>
                        <i class="fas fa-chart-pie"></i>
                    </div>
                    <div class="card-content">
                        <div class="equity-amount" id="account-equity">Loading...</div>
                        <div class="equity-change positive" id="equity-change">+$0.00 (0.0%)</div>
                    </div>
                </div>
                
                <div class="summary-card margin-card">
                    <div class="card-header">
                        <h3>Free Margin</h3>
                        <i class="fas fa-shield-alt"></i>
                    </div>
                    <div class="card-content">
                        <div class="margin-amount" id="free-margin">Loading...</div>
                        <div class="margin-level" id="margin-level">Margin Level: 0%</div>
                    </div>
                </div>
                
                <div class="summary-card pnl-card">
                    <div class="card-header">
                        <h3>Today's P&L</h3>
                        <i class="fas fa-trending-up"></i>
                    </div>
                    <div class="card-content">
                        <div class="pnl-amount positive">+$125.00</div>
                        <div class="pnl-percentage">+1.25%</div>
                    </div>
                </div>
            </div>

            <!-- Quick Actions -->
            <div class="quick-actions">
                <h3>Quick Actions</h3>
                <div class="action-buttons">
                    <button class="action-button primary" onclick="openTradingModal()">
                        <i class="fas fa-plus"></i>
                        <span>New Trade</span>
                    </button>
                    <button class="action-button secondary" onclick="showDeposit()">
                        <i class="fas fa-arrow-down"></i>
                        <span>Deposit</span>
                    </button>
                    <button class="action-button secondary" onclick="showWithdraw()">
                        <i class="fas fa-arrow-up"></i>
                        <span>Withdraw</span>
                    </button>
                    <button class="action-button secondary" onclick="goToAnalytics()">
                        <i class="fas fa-chart-line"></i>
                        <span>Analytics</span>
                    </button>
                </div>
            </div>

            <!-- Portfolio Overview -->
            <div class="portfolio-overview">
                <div class="portfolio-header">
                    <h3>Portfolio Performance</h3>
                    <div class="time-filters">
                        <button class="time-btn active" data-period="1D">1D</button>
                        <button class="time-btn" data-period="1W">1W</button>
                        <button class="time-btn" data-period="1M">1M</button>
                        <button class="time-btn" data-period="3M">3M</button>
                        <button class="time-btn" data-period="1Y">1Y</button>
                    </div>
                </div>
                <div class="portfolio-chart">
                    <canvas id="portfolioChart"></canvas>
                </div>
            </div>

            <!-- Open Positions -->
            <div class="open-positions">
                <div class="section-header">
                    <h3>Open Positions</h3>
                    <a href="#" class="view-all">View All</a>
                </div>
                <div class="positions-table">
                    <table>
                        <thead>
                            <tr>
                                <th>Symbol</th>
                                <th>Type</th>
                                <th>Volume</th>
                                <th>Open Price</th>
                                <th>Current Price</th>
                                <th>P&L</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="positionsTableBody">
                            <tr>
                                <td>
                                    <div class="symbol-info">
                                        <span class="symbol">EUR/USD</span>
                                        <span class="symbol-name">Euro vs US Dollar</span>
                                    </div>
                                </td>
                                <td><span class="trade-type buy">BUY</span></td>
                                <td>0.10</td>
                                <td>1.0850</td>
                                <td class="current-price">1.0875</td>
                                <td class="pnl positive">+$25.00</td>
                                <td>
                                    <button class="btn-close" onclick="closePosition('EUR/USD')">
                                        <i class="fas fa-times"></i>
                                    </button>
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    <div class="symbol-info">
                                        <span class="symbol">GBP/USD</span>
                                        <span class="symbol-name">British Pound vs US Dollar</span>
                                    </div>
                                </td>
                                <td><span class="trade-type sell">SELL</span></td>
                                <td>0.05</td>
                                <td>1.2650</td>
                                <td class="current-price">1.2635</td>
                                <td class="pnl positive">+$7.50</td>
                                <td>
                                    <button class="btn-close" onclick="closePosition('GBP/USD')">
                                        <i class="fas fa-times"></i>
                                    </button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Market Overview -->
            <div class="market-overview-dashboard">
                <h3>Market Overview</h3>
                <div class="market-grid">
                    <div class="market-item">
                        <div class="market-symbol">EUR/USD</div>
                        <div class="market-price">1.0875</div>
                        <div class="market-change positive">+0.0025 (+0.23%)</div>
                    </div>
                    <div class="market-item">
                        <div class="market-symbol">GBP/USD</div>
                        <div class="market-price">1.2635</div>
                        <div class="market-change negative">-0.0015 (-0.12%)</div>
                    </div>
                    <div class="market-item">
                        <div class="market-symbol">USD/JPY</div>
                        <div class="market-price">149.85</div>
                        <div class="market-change positive">+0.45 (+0.30%)</div>
                    </div>
                    <div class="market-item">
                        <div class="market-symbol">AUD/USD</div>
                        <div class="market-price">0.6785</div>
                        <div class="market-change positive">+0.0012 (+0.18%)</div>
                    </div>
                </div>
            </div>

            <!-- Recent Activity -->
            <div class="recent-activity">
                <h3>Recent Activity</h3>
                <div class="activity-list">
                    <div class="activity-item">
                        <div class="activity-icon">
                            <i class="fas fa-arrow-up text-success"></i>
                        </div>
                        <div class="activity-content">
                            <div class="activity-title">Deposit Completed</div>
                            <div class="activity-description">$1,000.00 deposited via Bank Transfer</div>
                            <div class="activity-time">2 hours ago</div>
                        </div>
                    </div>
                    <div class="activity-item">
                        <div class="activity-icon">
                            <i class="fas fa-chart-line text-primary"></i>
                        </div>
                        <div class="activity-content">
                            <div class="activity-title">Trade Opened</div>
                            <div class="activity-description">BUY 0.10 EUR/USD at 1.0850</div>
                            <div class="activity-time">4 hours ago</div>
                        </div>
                    </div>
                    <div class="activity-item">
                        <div class="activity-icon">
                            <i class="fas fa-times-circle text-danger"></i>
                        </div>
                        <div class="activity-content">
                            <div class="activity-title">Trade Closed</div>
                            <div class="activity-description">SELL 0.05 USD/CAD - Profit: +$15.50</div>
                            <div class="activity-time">6 hours ago</div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Portfolio Section -->
        <section id="portfolio-section" class="dashboard-section">
            <div class="section-header">
                <h2>Portfolio Overview</h2>
                <p>Track your trading performance and positions</p>
            </div>
            <div class="portfolio-content">
                <div class="portfolio-summary">
                    <div class="summary-card">
                        <div class="card-header">
                            <h3>Total Portfolio Value</h3>
                            <i class="fas fa-chart-pie"></i>
                        </div>
                        <div class="card-content">
                            <div class="portfolio-value">$10,250.00</div>
                            <div class="portfolio-change positive">+$125.00 (1.2%)</div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Markets Section -->
        <section id="markets-section" class="dashboard-section">
            <div class="section-header">
                <h2>Market Overview</h2>
                <p>Live market data and trading opportunities</p>
            </div>
            <div class="markets-content">
                <div class="market-pairs">
                    <div class="pair-card">
                        <div class="pair-info">
                            <span class="pair-name">EUR/USD</span>
                            <span class="pair-price">1.0875</span>
                        </div>
                        <div class="pair-change positive">+0.0025 (+0.23%)</div>
                    </div>
                </div>
            </div>
        </section>

        <!-- History Section -->
        <section id="history-section" class="dashboard-section">
            <div class="section-header">
                <h2>Trading History</h2>
                <p>Review your past trades and transactions</p>
            </div>
            <div class="history-content">
                <div class="history-table">
                    <p>Trading history will be displayed here</p>
                </div>
            </div>
        </section>

        <!-- Analytics Section -->
        <section id="analytics-section" class="dashboard-section">
            <div class="section-header">
                <h2>Analytics & Reports</h2>
                <p>Detailed performance analysis and insights</p>
            </div>
            <div class="analytics-content">
                <div class="analytics-charts">
                    <p>Analytics charts will be displayed here</p>
                </div>
            </div>
        </section>

        <!-- Education Section -->
        <section id="education-section" class="dashboard-section">
            <div class="section-header">
                <h2>Trading Education</h2>
                <p>Learn and improve your trading skills</p>
            </div>
            <div class="education-content">
                <div class="education-modules">
                    <p>Educational content will be displayed here</p>
                </div>
            </div>
        </section>
    </main>

    <!-- Scripts -->
    <script type="module" src="js/firebase-config.js"></script>
    <script type="module" src="js/firebase-auth.js"></script>
    <script type="module" src="js/firebase-database.js"></script>
    <script type="module" src="js/auth-integration.js"></script>
    <script type="module" src="js/user-profile-service.js"></script>
    <script src="js/dashboard.js"></script>
</body>
</html>